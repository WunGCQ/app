require(["node","io","CONF","newsManager","tooltip","toast"],function(t,n,e,i,o,a){function l(t){var n=document.querySelector("#ueditor-container").getBoundingClientRect(),e=UE.getEditor(t,{initialFrameWidth:n.width,initialFrameHeight:n.height-120,initialContent:"新闻内容"});return window.ue=e,e.ready(function(){u()}),e}function c(n){var e=t("<li>");e.text(n.title).attr("data-id",n._id).addClass("news-list__item"),g.prepend(e)}function d(t){(!p||p._id!==t._id||r())&&(v.val()!==t.title&&v.val(t.title),w.getContent()!==t.content&&w.setContent(t.content),p=t)}function r(){return p?p.title!==v.val()||p.content!==w.getContent():!1}function u(){v.attr("disabled","disabled"),w.setDisabled()}function s(){v.removeAttr("disabled"),w.setEnabled()}function f(t){t.removeAttr("disabled"),t.text(t.attr("data-enabled-text"))}function b(t){t.attr("disabled","disabled"),t.text(t.attr("data-disabled-text"))}var g=t.one("#news-list"),v=t.one("#news-title-input"),w=l("ueditor"),m=t.one("#news-publish-btn"),h=t.one("#news-create-btn"),C=t.one("#news-draft-btn"),p=null;h.on("click",function(){p&&r()?confirm("modified. save?"):i.create().then(function(t){d(t),c(t),s()},function(t){})}),m.on("click",function(t){if(p&&r()){var n=i.copy(p);n.content=w.getContent(),n.title=v.val(),b(m),i.save(n).then(function(t){d(t),f(m)},function(t){console.log(t),f(m)})}}),C.on("click",function(){b(C),setTimeout(function(){f(C)},2e3)}),g.delegate("click",".news-list__item",function(n){var e=t(n.target).attr("data-id").slice(1,-1);i.get(e).then(function(t){s(),d(t)},function(t){console.log(t)})}),o.init(),window.Tooltip=o});