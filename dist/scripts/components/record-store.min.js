define("RecordStore",["CONF","promise","utils"],function(e,t,o){function r(e){this.conf=e,this.records={},this.groups={},this._prepare()}function n(e){var t=[],o=i.keys(e);return i.each(o,function(o){t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]))}),t.join("&")}var s=e("promise"),i=e("utils");return r.prototype._prepare=function(){var e=this.groups;i.each(this.conf.groups,function(t){e[t]=[]})},r.prototype.getOne=function(e){var t=new s.Defer,o=this.records,r=o[e],i=this.conf.getOne,c=i.url+"/"+e;return i.query&&(c=c+"?"+n(i.query)),r?t.resolve(r):axios.get(c).then(function(n){r=n.data.data,o[e]=r,t.resolve(r)},function(e){t.reject(e)}),t.promise},r.prototype.deleteOne=function(e){var t=this,o=new s.Defer,r=this.conf.deleteOne,n=r.url+"/"+e;return axios["delete"](n).then(function(r){console.log(r),t.deleteLocalOne(e),o.resolve(r.data)},function(e){o.reject(e)}),o.promise},r.prototype.saveOne=function(e){e=e||{};var t=this.records,o=new s.Defer,r=this.conf.saveOne,n=e._id,c=n?"put":"post",p=r.url+"/"+(n||"");return r.params&&(e=i.merge(r.params,e)),console.log(e),axios[c](p,e).then(function(e){var r=e.data;t[n]=r,o.resolve(r)},function(e){o.reject(e)}),o.promise},r.prototype.createOne=r.prototype.saveOne,r.prototype.copyOne=function(e){return i.clone(e)},r.prototype.updataLocalOne=function(e){var t=e._id,o=this.records;o[t]&&(o[t]=e)},r.prototype.deleteLocalOne=function(e){e="object"==typeof e?e._id:e,this.records[e]&&delete this.records[e]},r.prototype.getOnes=function(e,t){var o=this.groups[e],r=new s.Defer,c=this.conf.getOnes,p=c.url;return p=p+"?"+n(i.merge(c.queries,{group:e,skip:o.length})),axios.get(p).then(function(e){var t=e.data.list;console.log(e),o.push.apply(o,t),r.resolve(t)},function(e){r.reject(e)}),r.promise},r.prototype.getGroup=function(e){return this.groups[e]},r.prototype.getPage=function(e,t,o){e=this.groups[e];var r=new s.Defer,n=e.pages=e.pages||{},i=n[t],c=this.conf.getPage,p=c.url+"?page="+t;return o&&(p+="&archive="+o),i?(i._source="cached",r.resolve(i)):axios.get(p).then(function(e){i=e.data,n[t]=i,r.resolve(i)},function(e){r.reject(e)}),r.promise},r});