define("carousel",["node","promise"],function(t,e,i){function n(t,e){t="string"==typeof t?u(t).getDOMNode():t,this.conf=e||n.CONF,this.dom=t;var i=t.querySelectorAll(".carousel__slide"),r=t.querySelectorAll(".carousel__slide__indicator");this.indicators=l.map.call(r,function(t){return new s(t,this)},this),this.slides=l.map.call(i,function(t,e){return new o(t,this.indicators[e],this)},this),this.currentIndex=0,this.init()}function o(t,e,i){var n=t.style;this.dom=t,this.carousel=i,this.indicator=e,0===l.indexOf.call(t.parentElement.children,t)?e.active():m(n,"translateX(100%)"),n.opacity=1,this.subLayers=l.map.call(t.querySelectorAll(".carousel__slide__sublayer"),function(t){return new r(t)})}function r(t){this.dom=t}function s(t){this.dom=t}var a,u=t("node"),c=t("promise"),d=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,l=Array.prototype,m=function(t,e){t.webkitTransform=e,t.mozTransform=e,t.transform=e};return n.CONF={mute:2600,duration:600,auto_start:!0},a=o.prototype,a.trans=function(t){function e(t){t||(t=+new Date),a.update(t),a.done||d(e)}var i=this,n=new c.Defer,o=n.promise,r={},s={};r.tx=2>=t?0:3===t?-100:100,r.op=2>=t?1:0,s.tx=t>2?0:1===t?-100:100,s.op=t>2?1:0,t>2?this.indicator.active():this.indicator.inActive();var a=new TWEEN.Tween(r);return a.to(s,i.carousel.conf.duration).easing(TWEEN.Easing.Quintic.InOut).onUpdate(function(){i.updateSlide(this)}).onComplete(function(){a.done=!0,n.resolve()}).start(),d(e),o},a.updateSlide=function(t){m(this.dom.style,"translateX("+t.tx+"%)")},a=s.prototype,a.active=function(){this.dom.classList.add("carousel__slide__indicator--active")},a.inActive=function(){this.dom.classList.remove("carousel__slide__indicator--active")},a=n.prototype,a.init=function(){var t=this,e=u(t.dom),i=t.conf,n=function(e){var i=u(e.currentTarget),n=i.index();n!==t.currentIndex&&(t.pause(),t.promise?t.promise.then(function(){t.go(n)}):t.go(n))},o=function(e){t.resume()};e.delegate("mouseover",".carousel__slide__indicator",n),e.delegate("mouseleave",".carousel__indicators-wrapper",o),i.auto_start&&t.loop()},a.loop=function(){var t=this;t.timer=setTimeout(function(){t.next().then(function(){t.loop()})},t.conf.mute)},a.go=function(t){var e=this.slides.length,i=this.slides[this.currentIndex],n=t>this.currentIndex;t=(t+e)%e,console.log("trans from %d to %d",this.currentIndex+1,t+1),this.currentIndex=t;var o=this.slides[t],r=o.trans(n?4:3),s=i.trans(n?1:2);return this.promise=c.all([r,s]),this.promise},a.pre=function(){return this.go(this.currentIndex-1)},a.next=function(){return this.go(this.currentIndex+1)},a.pause=function(){clearTimeout(this.timer)},a.resume=a.loop,n});