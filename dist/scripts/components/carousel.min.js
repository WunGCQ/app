define("carousel",["node","promise"],function(t,e,i){function n(t,e){var i=this.$dom=c("string"===t?t:t);this.conf=e||n.CONF;var o=i.children(".carousel__slides-wrapper").children(),a=i.children(".carousel__indicators-wrapper").children();this.indicators=l.map.call(a,function(t){return new s(t,this)},this),this.slides=l.map.call(o,function(t,e){return new r(t,this.indicators[e],this)},this),this.currentIndex=0,this.init()}function r(t,e,i){var n=this.$dom=c(t);this.carousel=i,this.indicator=e,0===n.index()?e.active():h(n,"translateX(100%)"),n.css("opacity",1);var r=n.children(".carousel__slide__sublayer");this.subLayers=l.map.call(r,function(t){return new o(t)})}function o(t){this.$dom=c(t)}function s(t){this.$dom=c(t)}var a,c=t("node"),u=t("promise"),d=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,l=Array.prototype,h=function(t,e){var i={transform:e,"-webkit-transform":e,"-moz-transform":e};t.css(i)};return n.CONF={mute:2600,duration:600,auto_start:!0},a=r.prototype,a.trans=function(t){function e(t){t||(t=+new Date),a.update(t),a.done||d(e)}var i=this,n=new u.Defer,r=n.promise,o={},s={};o.tx=2>=t?0:3===t?-100:100,o.op=2>=t?1:0,s.tx=t>2?0:1===t?-100:100,s.op=t>2?1:0,t>2?this.indicator.active():this.indicator.inActive();var a=new TWEEN.Tween(o);return a.to(s,i.carousel.conf.duration).easing(TWEEN.Easing.Quintic.InOut).onUpdate(function(){i.updateSlide(this)}).onComplete(function(){a.done=!0,n.resolve()}).start(),d(e),r},a.updateSlide=function(t){h(this.$dom,"translateX("+t.tx+"%)")},a=s.prototype,a.active=function(){this.$dom.addClass("carousel__slide__indicator--active")},a.inActive=function(){this.$dom.removeClass("carousel__slide__indicator--active")},a=n.prototype,a.init=function(){var t=this,e=t.$dom,i=t.conf,n=function(e){var i=c(e.currentTarget),n=i.index();n!==t.currentIndex&&(t.pause(),t.promise?t.promise.then(function(){t.go(n)}):t.go(n))},r=function(e){t.resume()};e.delegate("mouseover",".carousel__slide__indicator",n),e.delegate("mouseleave",".carousel__indicators-wrapper",r),i.auto_start&&t.loop()},a.loop=function(){var t=this;t.timer=setTimeout(function(){t.next().then(function(){t.loop()})},t.conf.mute)},a.go=function(t){var e=this.slides.length,i=this.slides[this.currentIndex],n=t>this.currentIndex;t=(t+e)%e,console.log("trans from %d to %d",this.currentIndex+1,t+1),this.currentIndex=t;var r=this.slides[t],o=r.trans(n?4:3),s=i.trans(n?1:2);return this.promise=u.all([o,s]),this.promise},a.pre=function(){return this.go(this.currentIndex-1)},a.next=function(){return this.go(this.currentIndex+1)},a.pause=function(){clearTimeout(this.timer)},a.resume=a.loop,n});