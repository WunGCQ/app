define("carousel",["node","promise"],function(t,e,n){function i(t,e){t="string"==typeof t?c(t).getDOMNode():t,this.conf=e||i.CONF,this.dom=t,this.indicators=l.map.call(t.lastElementChild.children,function(t){return new s(t,this)},this),this.slides=l.map.call(t.firstElementChild.children,function(t,e){return new o(t,this.indicators[e],this)},this),this.currentIndex=0,this.init()}function o(t,e,n){var i=t.style;this.dom=t,this.carousel=n,this.indicator=e,0===l.indexOf.call(t.parentElement.children,t)?e.active():h(i,"translateX(100%)"),i.opacity=1,this.subLayers=l.map.call(t.querySelectorAll(".carousel__slide__sublayer"),function(t){return new r(t)})}function r(t){this.dom=t}function s(t){this.dom=t}var a,c=t("node"),u=t("promise"),d=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,l=Array.prototype,h=function(t,e){t.webkitTransform=e,t.mozTransform=e,t.transform=e};return i.CONF={"break":2600,duration:600,auto_start:!0},a=o.prototype,a.trans=function(t){function e(t){t||(t=+new Date),a.update(t),a.done||d(e)}var n=this,i=new u.Defer,o=i.promise,r={},s={};r.tx=2>=t?0:3===t?-100:100,r.op=2>=t?1:0,s.tx=t>2?0:1===t?-100:100,s.op=t>2?1:0,t>2?this.indicator.active():this.indicator.inActive();var a=new TWEEN.Tween(r);return a.to(s,n.carousel.conf.duration).easing(TWEEN.Easing.Quintic.InOut).onUpdate(function(){n.updateSlide(this)}).onComplete(function(){a.done=!0,i.resolve()}).start(),d(e),o},a.updateSlide=function(t){h(this.dom.style,"translateX("+t.tx+"%)")},a=s.prototype,a.active=function(){this.dom.classList.add("carousel__slide__indicator--active")},a.inActive=function(){this.dom.classList.remove("carousel__slide__indicator--active")},a=i.prototype,a.init=function(){var t=this,e=c(t.dom),n=(t.conf,function(e){var n=c(e.currentTarget),i=n.index();i!==t.currentIndex&&(t.pause(),t.promise.then(function(){t.go(i)}))}),i=function(e){t.resume()};e.delegate("mouseover",".carousel__slide__indicator",n),e.delegate("mouseleave",".carousel__indicators-wrapper",i),this.loop()},a.loop=function(){var t=this;t.timer=setTimeout(function(){t.next().then(function(){t.loop()})},t.conf["break"])},a.go=function(t){var e=this.slides.length,n=this.slides[this.currentIndex],i=t>this.currentIndex;t=(t+e)%e,console.log("trans from %d to %d",this.currentIndex+1,t+1),this.currentIndex=t;var o=this.slides[t],r=o.trans(i?4:3),s=n.trans(i?1:2);return this.promise=u.all([r,s]),this.promise},a.pre=function(){return this.go(this.currentIndex-1)},a.next=function(){return this.go(this.currentIndex+1)},a.pause=function(){clearTimeout(this.timer)},a.resume=a.loop,i});