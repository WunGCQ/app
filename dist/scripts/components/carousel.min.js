define("carousel",["node","promise"],function(t,e,n){function i(t,e){var n=this.$dom=u("string"===t?t:t);this.conf=e||i.CONF,this.indicators=[],this.slides=[];for(var r=n.children(".carousel__slides-wrapper").children(),a=n.children(".carousel__indicators-wrapper").children(),c=0,d=r.length;d>c;c++)this.indicators.push(new s(a[c],this)),this.slides.push(new o(r[c],this.indicators[c],this));this.currentIndex=0,this.init()}function o(t,e,n){var i=this.$dom=u(t);this.carousel=n,this.indicator=e,this.subLayers=[],0===i.index()?e.active():h(i,"translateX(100%)"),i.css("opacity",1);for(var o=i.children(".carousel__slide__sublayer"),s=0,a=o.length;a>s;s++)this.subLayers.push(new r(o[s]))}function r(t){this.$dom=u(t)}function s(t){this.$dom=u(t)}var a,u=t("node"),c=t("promise"),d=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},h=function(t,e){var n={transform:e,"-webkit-transform":e,"-moz-transform":e};t.css(n)};return i.CONF={mute:2600,duration:600,auto_start:!0},a=o.prototype,a.trans=function(t){function e(t){t||(t=+new Date),a.update(t),a.done||d(e)}var n=this,i=new c.Defer,o=i.promise,r={},s={};r.tx=2>=t?0:3===t?-100:100,r.op=2>=t?1:0,s.tx=t>2?0:1===t?-100:100,s.op=t>2?1:0,t>2?this.indicator.active():this.indicator.inActive();var a=new TWEEN.Tween(r);return a.to(s,n.carousel.conf.duration).easing(TWEEN.Easing.Quintic.InOut).onUpdate(function(){n.updateSlide(this)}).onComplete(function(){a.done=!0,i.resolve()}).start(),d(e),o},a.updateSlide=function(t){h(this.$dom,"translateX("+t.tx+"%)")},a=s.prototype,a.active=function(){},a.inActive=function(){},a=i.prototype,a.init=function(){var t=this,e=t.$dom,n=t.conf,i=function(e){var n=u(e.currentTarget),i=n.index();i!==t.currentIndex&&(t.promise?(t.pause(),t.promise.then(function(){t.go(i)})):t.go(i))},o=function(e){t.resume()};e.delegate("mouseover",".carousel__slide__indicator",i),e.delegate("mouseleave",".carousel__indicators-wrapper",o),n.auto_start&&t.loop()},a.loop=function(){var t=this;t.timer=setTimeout(function(){t.next().then(function(){t.loop()})},t.conf.mute)},a.go=function(t){var e=this.slides.length,n=this.slides[this.currentIndex],i=t>this.currentIndex;t=(t+e)%e,console.log("trans from %d to %d",this.currentIndex+1,t+1),this.currentIndex=t;var o=this.slides[t],r=o.trans(i?4:3),s=n.trans(i?1:2);return this.promise=c.all([r,s]),this.promise},a.pre=function(){return this.go(this.currentIndex-1)},a.next=function(){return this.go(this.currentIndex+1)},a.pause=function(){clearTimeout(this.timer)},a.resume=a.loop,i});
