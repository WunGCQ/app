require(["node","utils","tooltip","CONF","personAgent","mask","toast","modal","io"],function(e,n,a,t,o,r,d,s,i){function l(){var e=new i({url:n.appendQueries(F,{_id:N._id}),type:"post",form:"#up-form",dataType:"json"});return e}function c(n){var a=e("<div>"),t=e("<a>"),o=e("<a>"),r=e("<img>"),d=e("<h4>"),s=e("<h4>"),i=e("<i>"),l=e("<span>"),c=e("<p>");t.addClass("person-card__edit-btn fa fa-pencil"),o.addClass("person-card__delete-btn fa fa-trash"),r.attr("src",n.avatar),r.addClass("person-card__avatar"),d.text("@"+n.name),i.addClass("fa fa-flag person-card__meta-label"),l.text(n.role),s.addClass("person-card__meta"),s.append(i),s.append(l),c.addClass("person-card__description"),c.text(n.description),a.addClass("person-card"),a.append(t),a.append(o),a.append(r),a.append(d),a.append(s),a.append(c),O.prepend(a)}function p(e){e=e||u(),N&&N._id&&(e._id=N._id),n.disableEl(g),j.saveOne(e).then(function(e){N=e,d.make("first");var n=k[0].files[0];return n?l(n):e}).then(function(e){console.log(e);var a=e[0];N.avatar=a.url,d.make("done"),n.enableEl(g),k.val(""),f().then(function(){c(N)})},function(e){console.log(e),n.enableEl(g),k.val(""),f()})}function u(){var e={};return e.name=A.val(),e.role=y.val(),e.description=L.val(),e}function _(){return m.addClass("faculty-editor-wrapper--active"),s.open(m).then(function(){b.addClass("faculty-editor--up")})}function f(){return s.close().then(function(){b.removeClass("faculty-editor--up")})}var v=e(".add-person-btn"),m=e(".faculty-editor-wrapper"),b=e(".faculty-editor"),w=e(".modal__closer"),g=(e(".modal__cancel-btn"),e(".modal__confirm-btn")),h=e("#up-form"),C=e(".person__avatar-preview"),k=e(".person__avatar-selector"),A=e(".person__name-editor"),y=e(".person__role-editor"),L=e(".person__description-editor"),O=e(".person-gallery"),x=LANG.actions.edit,E=LANG.actions["delete"],N=null,j=new o({saveOne:{url:t.API.person.root}}),F=t.API.person.uploadAvatar;s.setConf({base:{"background-color":"transparent"}}),v.on("click",_),w.on("click",f),g.on("click",function(){p()}),k.on("change",function(e){var n=k[0].files[0];C.attr("src",URL.createObjectURL(n)),console.log(n)}),O.delegate("click",".person-card__edit-btn",function(e){}),O.delegate("mouseover",".person-card__edit-btn",function(e){a.show(e.target,x)}),O.delegate("mouseover",".person-card__delete-btn",function(e){a.show(e.target,E)}),O.delegate("mouseout",[".person-card__edit-btn",".person-card__delete-btn"],function(e){a.hide()}),a.init(),window.Mask=r,window.Toast=d,window.personAgent=j,window.$editorAvatarForm=h,window.$personAvatarSelector=k});