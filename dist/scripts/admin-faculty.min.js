require(["node","utils","tooltip","CONF","personAgent","mask","toast","modal","io"],function(e,a,n,o,t,r,d,s,i){function l(){var e=new i({url:a.appendQueries(F,{_id:N._id}),type:"post",form:"#up-form",dataType:"json"});return e}function p(a){var n=e("<div>"),o=e("<a>"),t=e("<a>"),r=e("<img>"),d=e("<h4>"),s=e("<h4>"),i=e("<i>"),l=e("<span>"),p=e("<p>");o.addClass("person-card__edit-btn fa fa-pencil"),t.addClass("person-card__delete-btn fa fa-trash"),r.attr("src",a.avatar),r.addClass("person-card__avatar"),d.text("@"+a.name),i.addClass("fa fa-flag person-card__meta-label"),l.text(a.role),s.addClass("person-card__meta"),s.append(i),s.append(l),p.addClass("person-card__description"),p.text(a.description),n.addClass("person-card"),n.append(o),n.append(t),n.append(r),n.append(d),n.append(s),n.append(p),O.prepend(n)}function c(e){e=e||u(),N&&N._id&&(e._id=N._id),a.disableEl(g),j.saveOne(e).then(function(e){N=e,d.make("first");var a=A[0].files[0];return a?l(a):e}).then(function(e){console.log(e);var n=e[0];N.avatar=n.url,d.make("done"),a.enableEl(g),A.val(""),f().then(function(){p(N)})},function(e){console.log(e),a.enableEl(g),A.val(""),f()})}function u(){var e={};return e.name=k.val(),e.role=y.val(),e.description=L.val(),e}function _(){return m.addClass("faculty-editor-wrapper--active"),s.open(m).then(function(){w.addClass("faculty-editor--up")})}function f(){return s.close().then(function(){w.removeClass("faculty-editor--up")})}var v=e(".add-person-btn"),m=e(".faculty-editor-wrapper"),w=e(".faculty-editor"),b=e(".modal__closer"),g=(e(".modal__cancel-btn"),e(".modal__confirm-btn")),h=e("#up-form"),C=e(".person__avatar-preview"),A=e(".person__avatar-selector"),k=e(".person__name-editor"),y=e(".person__role-editor"),L=e(".person__description-editor"),O=e(".person-gallery"),x=LANG.actions.edit,E=LANG.actions["delete"],N=null,j=new t({saveOne:{url:o.API.person.root}}),F=o.API.person.uploadAvatar;s.setConf({base:{"background-color":"transparent"}}),v.on("click",_),b.on("click",f),g.on("click",function(){c()}),A.on("change",function(e){var a=A[0].files[0];C.attr("src",URL.createObjectURL(a)),console.log(a)}),O.delegate("mouseover",".person-card__edit-btn",function(e){n.show(e.target,x)}),O.delegate("mouseover",".person-card__delete-btn",function(e){n.show(e.target,E)}),O.delegate("mouseout",[".person-card__edit-btn",".person-card__delete-btn"],function(e){n.hide()}),n.init(),window.Mask=r,window.Toast=d,window.personAgent=j,window.$editorAvatarForm=h,window.$personAvatarSelector=A});