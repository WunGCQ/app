require(["node","io","CONF","RecordManager","tooltip","toast"],function(e,t,n,o,i,r){function c(e){var t=document.querySelector("#ueditor-container").getBoundingClientRect(),n=UE.getEditor(e,{initialFrameWidth:t.width,initialFrameHeight:t.height-120,initialContent:"新闻内容"});return n.ready(function(){u()}),n}function d(t){var n=e("<li>");n.text(t.title).attr("data-id",t._id).addClass("records-list__item"),g.prepend(n)}function a(e){(!m||m._id!==e._id||l())&&(b.val()!==e.title&&b.val(e.title),h.getContent()!==e.content&&h.setContent(e.content),m=e),m._id&&h.execCommand("serverparam","_id",m._id)}function l(){return m?m.title!==b.val()||m.content!==h.getContent():!1}function u(){b.attr("disabled","disabled"),h.setDisabled()}function s(){b.removeAttr("disabled"),h.setEnabled()}function f(e,t){this.conf=t,this.recordManager=e}var g=e.one("#records-list"),b=e.one("#record-title-input"),h=c("ueditor"),v=e.one("#record-publish-btn"),p=e.one("#record-create-btn"),O=e.one("#record-draft-btn"),m=null,_={getOne:n.API.record,deleteOne:n.API.record,saveOne:n.API.record},C=new o(_);return p.on("click",function(){m&&l()?confirm("modified. save?"):C.createOne().then(function(e){a(e),d(e),s()},function(e){})}),v.on("click",function(e){if(m&&l()){var t=C.copyOne(m);t.content=h.getContent(),t.title=b.val(),disableBtn(v),C.saveOne(t).then(function(e){a(e),enableBtn(v)},function(e){console.log(e),enableBtn(v)})}}),O.on("click",function(){disableBtn(O),setTimeout(function(){enableBtn(O)},2e3)}),g.delegate("click",".records-list__item",function(t){var n=e(t.target).attr("data-id");C.getOne(n).then(function(e){s(),a(e)},function(e){console.log(e)})}),g.delegate("click",".record-delete-btn",function(t){t.stopPropagation();var n=e.one(t.target),o=n.attr("data-id");C.deleteOne(o).then(function(e){console.log(e)},function(e){console.log(e)})}),f.prototype.init=function(){var t=this,n=this.conf,o=this.recordManager;f.$recordsList.delegate("click",".records-list__item",function(i){var r=e(i.target).attr("data-id");o.getOne(r).then(function(e){n.onGetOneSucceed&&n.onGetOneSucceed.call(t,e)},function(e){n.onGetOneFailed&&n.onGetOneFailed.call(t,e)})})},f.$recordsList=e.one("#records-list"),f.$recordTitleInput=e.one("#record-title-input"),f.$recordPublishBtn=e.one("#record-publish-btn"),f.$recordCreateBtn=e.one("#record-create-btn"),f.$recordSaveDraftBtn=e.one("#record-draft-btn"),f.recordContentEditor=c("ueditor"),f.currentRecord=null,i.init(),f});